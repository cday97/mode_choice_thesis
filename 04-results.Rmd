# Results {#results}
We estimated ride-hailing ridership and level of service for each of the nine previously mentioned ActivitySim-to-BEAM mode choice combinations. Specifically, we estimated ride-hailing ridership, wait time, and utilization. Alongside each other, these results shed light on the performance of estimating ride-haling ridership and level of service with an activity-based model and multi-agent simulation. We can see how differing mode choice structures affect the use and performance of ride-hailing modes.

## Ridership {#res-ridership}
Table \@ref(tab:ridership) shows the number of trips for the ride hail, pooled ride hail, and ride hail transit type modes for all nine mode choice combinations. Table \@ref(tab:ridership) also includes the number of trips within the plans with ride hail created by ActivitySim, before the mode choices were changed by the BEAM.

```{r ridership, echo=FALSE}
library(kableExtra)
ridership <- tar_read(ridership)
landscape(kable(ridership, caption = 'Ride Hail Ridership by Number of Total Trips by Mode Choice Combination.', booktabs = TRUE) %>%
  row_spec(1,italic = TRUE, background = "#D9D9D9") %>%
  row_spec(2, background = "#FAEBD7") %>%
  row_spec(3:6, background = "#FFB6C1") %>%
  row_spec(7:10, background = "#ADD8E6"),margin = NULL)
```

By comparing scenarios amongst each other, we can understand how slight differences in the mode choice model can significantly affect ridership totals. We first compare the AsimRideHail scenario with the ActivitySim scenario. Comparing these two scenarios we see how BEAM severely undercuts the number of ride-hailing trips estimated in the input plans generated by ActivitySim. ActivitySim estimated a total of 4,249 ride-hailing trips whereas the AsimRideHail scenario only estimated 300. Even with no mode choice model in BEAM, by simply running ActivitySim's ride-hailing estimates in the BEAM environment, BEAM was unable to create ride-hailing paths in most cases. 

On the other hand, by comparing the AsimRideHail scenario with the *RideHail* type scenarios we see that the ridership totals are greater than in the AsimRideHail scenario. The BEAM mode choice structure which allows only ride hail modal innovation will predict significantly higher ridership totals than both ActivitySim and AsimRideHail. Then, by comparing the AsimRideHail scenario with the BeamAll scenarios we see the effectiveness of BEAM at estimating ride hail modes without ride hail being selected in the initial plans. Both BeamAll scenarios display a large increase in total ride hail ridership when compared with the AsimRideHail scenario. Also, by comparing the *All* type scenarios, we notice that BEAM will estimate higher ridership totals than AsimRideHail and ActivitySim, independent of whether or not the input plans include ride hailing modes. 

Interestingly, by comparing the AsimRideHail scenario with the AsimBeamAll:PPL scenario we learn about the inter-workings of the BEAM mode choice that is most consistent with ActivitySim. The BeamAll:PPL and AsimBeamAll:PPL scenarios reference a BEAM mode choice structure which uses the same modal options and utility parameters as ActivitySim. By comparing AsimBeamAll:PPL with the AsimRideHail scenario, we see how ride hail statistics *differ* when modeled with an activity-based model than with a multiagent simulation. Looking at the differences between the ActivitySim and AsimBeamAll:PPL scenarios in Table \@ref(tab:ridership), we see an increase of 5,091 trips by simply turning on modal innovation in BEAM. We conclude that BEAM is more prone to estimating higher ridership totals for ride-hailing modes than ActivitySim when modal innovation is turned on.

Next, by analyzing the collective groups within the table, we can extract deeper results. First, we examine the effect of ride-hailing existing in the input plans. As shown in Table \@ref(tab:ridership), minimal differences in ridership is produced between scenarios with the *Asim* prefix vs. without. For example, with  the BeamRideHail:Path and AsimBeamRideHail:Path, we see that when ride hail doesn't exist in the input plans, the total ride-hailing trips is 72,958 whereas when ride hail type modes are included, the total ride-hailing modes is 67,829 trips. Both scenarios project an enormous share of ride-hailing trips. Similarly, the gap between the ride-hailing trips of the BeamRideHail:PPL and AsimBeamRideHail:PPL scenario is relatively close, at 62,463 and 78,597 trips respectively. Then, when examining BeamAll:PPL and AsimBeamAll:PPL, the output ridership percentages are almost identical; similarly, the ride-hailing trip totals of the BeamAll:Path and AsimBeamAll:Path scenarios are close. Overall, by collectively comparing all the scenarios with ride-hailing input plans against those without, we see similar ridership results among similar mode choice structures.

Although input plans do not seem to have a significant effect on ridership, the BEAM mode choice strucutres do. The *None* type scenario (AsimRideHail) produces little to no agents choosing ride hail. On the other hand, the *RideHail* type scenarios produce the largest number of ride hail modes amoung BEAM mode choice structures. The *All* type scenarios produce a significantly larger number of ride hail modes than the *None* type, but a singificantly lower numer of ride hail modes than the *RideHail* type. In addition, the *All* type scenarios seem to predict similar ridership values with ActivitySim. For example, the number of ride hail only type trips is 2,259 more in the BeamAll:Path scenario than in the ActivitySim scenario. Ridership is affected significantly by which mode choice structure is used by BEAM; this conclusion is clear. 

Finally, we analyze the effect the BEAM utility variables have on ride hail ridership totals. We first compare the BeamRideHail:Path and BeamRideHail:PPL scenarios. In this case, ride hail only ridership decreases (45,001 and 18,907) when using path, person, and location variables, but increases with pooled ride hail (25,014 and 38,935) and ride hail transit (2,943 and 4,621) when using path, person, and location variables. This same pattern occurs when analyzing the difference between the BeamAll:Path and BeamAll:PPL, and AsimBeamAll:Path and AsimBeamAll:PPL scenarios. For some oddity, AsimBeamRideHail:Path and AsimBeamRideHail:PPL follow an opposite pattern where ride hail increases (21,519 and 47,422) and ride hail pooled decreases (40,873 and 27,327) and ride hail transit decreases (5,437 and 3,848) when using path, person, and location variables. We acknowledge that not all scenarios follow the same pattern, but hypothesize that in general, using only path variables to estimate ride hail ridership will result in less total ride hail ridership than if using all path, person, and location type variables.


## Wait Times {#res-waits}
Figure \@ref(fig:waits) shows the results of wait times for ride-hailing vehicles for the scenarios that were run. By analyzing the wait times with violin plots, we see a detailed distribution of the ride-hailing wait times for each scenario.

```{r waits, echo = FALSE, warning = FALSE, message = FALSE, fig.cap = "Distribution of ride hail wait times by mode choice combination scenario.", fig.align='center'}
tar_read(waits)
```

As was done in Section \@ref(res-ridership), we can compare scenarios between one another For example, when looking at the AsimRideHail and AsimBeamAll:PPL scenairio, we see that wait times increase when using the BEAM mode choice model (minimum wait time increases from 0.7 to 1 minute, and mean wait time increases from 7.8 to 9.3 minutes). A noticeable increase in wait time is achieved by simply turning on modal innovation in BEAM. Since higher wait time suggest higher ridership, we conclude that BEAM is prone to estimating more ride hail usage than ActivitySim when modal innovation is turned on. Then, by comparing AsimRideHail and BeamAll:PPL we see the lack of impact that ride hail in the initial plans has on effective ride hail usage. The wait time mean may have increased from 7.8 to 8.4 minutes, but the maximum wait time decreased from 20.8 to 18.3 minutes. Although no ride-hailing existed in the input plans, BEAM was effectively able to calculate the usage of more ride hail vehicles with less maximum wait times.

As with ridership, analyzing wait times on a collective scale sheds additional light on how mode choice affects ride-hailing service capabilities. For example, collectively comparing the scenarios with the *Asim* prefix against the scenarios without, we see only a slight difference in maximum wait times. Scenarios AsimBeamRideHail:PPL, AsimBeamAll:Path, and AsimBeamAll:PPL have almost identical mean wait times when compared to their counterparts in BeamRideHail:PPL, BeamAll:Path, BeamAll:PPL. We suppose that the existence of ride hail in the initial plans will not affect *most* ride hail wait times. 

Alternately, comparing different BEAM mode options does significantly affect ride hail wait times. The *None* type scenario (AsimRideHail) has the largest spread of wait times, the lowest mean wait time, and is "bottom heavy" -- referring to the fact that a major cluster of users wait less than 7.5 minutes. The *All* type scenarios have higher mean wait times (~9.3 minutes) than the *None* type and lower mean wait times than the *RideHail* type. Neither top nor bottom heavy, the *All* type scenarios seem to have a more even spread in wait times, ranging from 0.4 to 21 minutes. BEAM seems to paint ride hail alternatives as more desirable than ActivitySim, as more users are willing to wait longer (12 to 18 minutes in the *All* scenarios). This is especially true with the *RideHail* type scenarios, as a large cluster of users are willing to wait 7.5 to 20 minutes. The *RideHail* type scenarios have the largest mean wait times (~10.65 minutes). Overall, wait time is significantly affected by which mode choice structure is used by BEAM, just like as was concluded with ridership.

The last group to compare collectively is between the Path and PPL models. By comparing BeamRideHail:Path and BeamRideHail:PPL, BeamAll:Path and BeamAll:PPL, and AsimBeamAll:Path and AsimBeamAll:PPL, we see that the Path models estimate a slightly higher maximum wait time. In addition, BeamRideHail:Path and AsimBeamRideHail:Path seem to have a larger cluster above a 10 minute wait time than BeamRideHail:PPL and AsimBeamRideHail:PPL. Besides these two observations though, the differences between utility parameters is minimal. Although ridership was affected by which utility parameters were used, wait time is only slightly affected.


### Summary
Overall, by analyzing the ridership amd wait times among different mode choice structures we learn that ride-hailing ridership and level of service is significantly affected by which mode choice structure is used in BEAM. We also propose that initial plans, and whether or not they include ride hail, do not significantly affect the level at which BEAM estimates ridership, however it may affect service capabilities like wait time. Lastly, we hypothesize that using all path, person, and location type variables will increase total ridership. We also suggest that the lack of person attributes in the utility equation may cause pooled and transit ride hail options to look less appealing. Section \@ref(deep-look) takes a deeper look at why some patterns in the ridership and wait times results exist.

## A Deeper Look at Ridership and Wait Times {#deep-look}
The results from Table \@ref(tab:tbexperiments) and the results from Figure \@ref(fig:waits) can be explained further by understanding the original setup of the experiments. The clearest distinction in ridership and wait times exist between BEAM mode choice structures. The *None*, *RideHail*, and *All* structure types each produce results at different magnitudes. These vastly different results are directly related to how each model structure is constructed.  

### None Mode Choice Model {#type1}
The *None* mode choice model produces the lowest ridership and quickest wait time values. With modal innovation turned off, agents were unable to choose new modes, and averted to walk modes if the current trip mode was deemed "impossible". This is verified by looking at Table \@ref(tab:noneloss). Iteration 0 (start) shows the number of ride-hailing modes input to BEAM. By the end of iteration 0, however, more than half the initial ride-hailing selections estimated by ActivitySim were lost. Then, by the end of the final iteration, only 300 ride-hailing trips remained. At the same time, total walk modes increased across each iteration. BEAM was unable to match agents with most of ActivitySim's ride-hailing predictions.

```{r, noneloss}
none <- matrix(c("0 (start)", 2412, 1837, 0, 4249,"0 (end)", 978, 615, 0, 1593, "12 (end)", 269, 21, 0, 300), ncol=5, byrow=TRUE)
colnames(none) <- c("Iteration", "Ride Hail", "Pooled Ride Hail", "Ride Hail Transit", "Total")
nonetab <- as.tibble(none)
kable(nonetab, caption = 'Loss of Ride-hailing trips in the None Mode Choice Model.', booktabs = TRUE)  %>%
  kable_styling(latex_options="scale_down")
```

### All Mode Choice Model {#type3}
The *All* BEAM mode choice model uses the same mode choice utility function as ActivitySim and has all modal alternatives available. This adjusted model structure helps us understand why we obtained much higher ridership than with the *None* Model. Figure \@ref(fig:piechart) shows from which modes agents who switched to ride-hailing came from. Interestingly enough, the majority of agents who select ride hail switched from car type modes (Car, HOV2, HOV3).

```{r piechart, echo = FALSE, warning = FALSE, message = FALSE, fig.cap = "Original mode choices of agents who switch to a ride hail type mode.", fig.align='center'}
tar_read(piechart)
#planshifts <- tar_read(planshifts)
#ggsave("planshifts.png", width = 9, height = 6)
# below is for wRH-All-All scenario
```

We offer three factors as to why so many car users switch to ride-hailing modes. The first is the array of utility parameters boosted the ride-hailing utility, making ride-hailing options attractive alternatives. Figure \@ref(fig:sankey) provides sufficient evidence for this claim. Figure \@ref(fig:sankey) shows a sankey diagram of all modal decisions at the start of each iteration for the AsimBeamAll:PPL scenario. The mode "No Mode" describes those modes that were cleared and reset at the beginning of each iteration. Notice how many of the Car, HOV2, HOV2 Passenger, HOV3, and HOV3 Passenger modes shift into the "No Mode" category each iteration. Also notice in the subsequent iteration how many of those "No Mode" choices shift to ride-hailing modes. A shift from the "No Mode" choice to ride hail represents those agents choosing their mode based on the utility value.

\begin{landscape}

\begin{figure}[H]
\centering
\includegraphics{planshifts.png}
\caption{The entire selection process of agents who use ride hail on the final iteration.}
\label{fig:sankey}
\end{figure}

\end{landscape}

The second factor for why agents switch from car to ride-hailing is BEAM's complex car tracking algorithm, which keeps track of household and agent level vehicle allocation. For example, if a household owns one vehicle, then the vehicle is *assigned* to the first agent to use it in their daily plan. This leaves the other household members to choose an alternate mode. BEAM's implementation of vehicular assignment prevents many agents from selecting a car mode, whereas ActivitySim may not prevent those same individuals from car usage.

In addition to BEAM's vehicle assignment algorithm, BEAM's trip based mode choice structure forces some car users to switch modes. Sometimes, agents will *lose* their vehicle within the day when a pathway cannot be built. If an agent *loses* their car, car is no longer a valid modal alternative for future trips. Figure \@ref(fig:walkers) provides evidence for this statement. Figure \@ref(fig:walkers) displays a graph of those agents who start their day using a mode other than walk, but end up switching to the walk mode by the end of the day. Notice how in each hour, walk increases as car decreases or remains constant. Hundreds of car type mode users are switching to walk modes instead of remaining with their vehicle. Figure \@ref(fig:sankey) shows that many walk users shift to ride-hailing each iteration. Therefore, car users who shift to walk on one trip, may shift to ride-hailing on the next trip. This is true between corresponding iterations as well. Overall, the increase in ridership in the *All* model can be partially explained for these three reasons.

```{r walkers, echo = FALSE, warning = FALSE, message = FALSE, fig.cap = "Agents who switch to walk by time of day (AsimBeamAll:PPL).", fig.align='center'}
#graph of those agents who start their day not walking, and switch to walking before the end of the day
#for wRH-All-All Scenario
tar_read(walk_switchers)
```

### Ridehail Mode Choice Model {#type2}
Finally, the way the *RideHail* BEAM mode choice model was constructed explains why their ridership and wait times were high. The *RideHail* model only permitted walk and transit users the option to switch to ride-hailing modes; car-type modes remained locked across each iteration. Whenever a ride-hailing path could be built, all walk modes were automatically given the option to choose ride hail or ride hail pooled and all transit modes were automatically given the option to choose ride hail transit. Although it made logical sense to lock all car-type modes (for reasons described in Section \@ref(type3)), by giving ride hail options only to walk and transit users, ridership increased even more than in the *All* scenario. The increase in ridership occurred because 1.) BEAM's adjusted code forced ride hail to be an option in almost all cases, and 2.) in most cases ride hail was calculated to be more attractive than walk or transit modes.

Table \@ref(tab:timeutil) provides evidence in ride hail being an attractive mode choice alternative. Table \@ref(tab:timeutil) displays the ride hail time utilization for each of the scenarios performed. The same ride hail fleet was used in each of the nine scenario, composed of 952 ride-hailing driver shifts. Ride hail time utilization was calculated as the sum of all the driver shift times divided by the sum of all passenger occupied ride-hailing travel time. The AsimRideHail scenario had the lowest ride hail time utilization, at only 4.046%. Interestingly, the *All* type scenarios ranged from 53.123% to 62.459% ride hail time utilization. This explains the higher wait times shown in Figure \@ref(fig:waits). Finally, by analyzing the ride hail time utilization for the *RideHail* scenarios, we fully understand how attractive ride hail was. With 70.270% to 73.777% of ride hail time utilization present for the *RideHail* scenarios, we see three fourths of each driver's shift was used to transport passengers. This explains the attractiveness of the choice, the extreme increase in ridership, and  also the increased wait time for the *RideHail* type scenarios.  

```{r timeutil, echo=FALSE}
time_utilization <- tar_read(ridehail_utilization) %>% select(2,6)
kable(time_utilization, caption = 'Percent Ride Hail Time Utilization by Mode Choice Combination Scenario', booktabs = TRUE)
  #kable_styling(latex_options="scale_down")
```

```{r personutil, echo=FALSE}
#person_utilization <- tar_read(rh_utilization) %>% select(1,6)
#kable(person_utilization, caption = 'Ride hail (person / hour) utilization by mode choice combination scenario.', booktabs = TRUE)  %>%
#  kable_styling(latex_options="scale_down")
```

### Summary
As seen by the explanation of the structure of the *None*, *All*, and *RideHail* type scenarios, how BEAM's different mode choice structures were programmed affected ride-hailing ridership and wait time. Fortunately, Section \@ref(discussion) further describes the deeper meaning behind the ride hail, wait time, and mode choice structure results discovered in this section.
