# Results {#results}
We estimated ride-hailing ridership and level of service for each of the nine previously mentioned ActivitySim-to-BEAM mode choice combinations. Specifically, we estimated ride-hailing ridership, wait time, and utilization. Alongside each other, these results shed light on the performance of estimating ride-haling ridership and level of service with an activity-based model and multi-agent simulation. We can see how differing mode choice structures affect the use and performance of ride-hailing modes.

## Ridership {#res-ridership}
Table \@ref(tab:ridership) shows the number of trips for the ride-hail, pooled ride-hail, and ride-hail transit type modes for all nine mode choice combinations. Table \@ref(tab:ridership) also includes the number of trips within the plans with ride-hail created by ActivitySim, before the mode choices were changed by the BEAM.

```{r ridership, echo=FALSE}
library(kableExtra)
ridership <- tar_read(ridership)
kbl(ridership, caption = 'Ride-hail Ridership by Number of Total Trips by Mode Choice Combination Scenario.', booktabs = TRUE, linesep = c("\\addlinespace",rep("",9)), format="latex") %>%
  row_spec(1,italic = TRUE, background = "#D9D9D9") %>%
  row_spec(2, background = "#FAEBD7") %>%
  row_spec(3:6, background = "#FFB6C1") %>%
  row_spec(7:10, background = "#ADD8E6")
```

By comparing scenarios against each other, we can understand how slight differences in the mode choice model can significantly affect ridership totals. We first compare the ActivitySim scenario with the AsimRideHail scenario. The ActivitySim scenario represents the ride-hailing input plans created by ActivitySim before being inserted into BEAM and the AsimRideHail scenario represents how these ride-hailing input plans change in BEAM while undergoing no new mode choice. Comparing these two scenarios we see the estimated 4,249 ride-hailing trips of ActivitySim diminished to 300 trips within BEAM because the AsimRideHail scenario was unable to recreate the same ride-hailing paths as ActivitySim. Then, comparing the *RideHail* and *All* type scenarios with the AsimRideHail scenario and ActivitySim scenario we see that the when BEAM mode choice innovation is turned on for all or part of the agents, BEAM predicts significantly higher ridership totals. As a result, we suppose that BEAM is prone to estimating higher ridership totals for ride-hailing modes than ActivitySim when modal innovation is turned on, and lower totals when turned off.

Next, we examine the effect the existence of ride-hailing in the input plans has on ridership. As shown in Table \@ref(tab:ridership), minimal differences in ridership is produced between scenarios with the *Asim* prefix vs. without. For example, between the BeamRideHail:Path and AsimBeamRideHail:Path scenarios we see that input plans without ride-hail produce 72,958 trips, whereas input plans with ride-hail produce 67,829 trips. Similarly, the gap between the ride-hailing trips of the BeamRideHail:PPL and AsimBeamRideHail:PPL scenario is relatively close, at 62,463 and 78,597 trips respectively. The output ridership trips are almost identical between the BeamAll:PPL and AsimBeamAll:PPL scenarios and close between the BeamAll:Path and AsimBeamAll:Path scenarios as well. Overall, we see similar ridership results among similar mode choice structures independent of the inclusion of ride-hailing in input plans.

We also notice that different BEAM mode choice models predict different ride-hailing ridership levels. The *None* type scenario (AsimRideHail) produces few agents choosing ride-hail. The *RideHail* type scenarios produce the largest number of ride-hail modes amoung BEAM mode choice structures. The *All* type scenarios produce more ride-hail modes than the *None* type, but less ride-hail modes than the *RideHail* type. In addition, the *All* type scenarios predicts similar ridership values as ActivitySim. The number of ride-hail only type trips is 2,259 more in the BeamAll:Path scenario than in the ActivitySim scenario. Overall, ridership is affected significantly by which mode choice structure is used by BEAM; this conclusion is clear. 

Finally, we analyze the effect the BEAM utility variables have on ride-hail ridership totals. Comparing the BeamRideHail:Path and BeamRideHail:PPL scenarios we see ride-hail only ridership decreases (45,001 and 18,907) when using path, person, and location variables, but increases with pooled ride-hail (25,014 and 38,935) and ride-hail transit (2,943 and 4,621). This same pattern occurs when analyzing the difference between the BeamAll:Path and BeamAll:PPL, and AsimBeamAll:Path and AsimBeamAll:PPL scenarios. For some oddity though, AsimBeamRideHail:Path and AsimBeamRideHail:PPL follow an opposite pattern. We acknowledge that not all scenarios follow the same pattern, but hypothesize that in general, using only path variables to estimate ride-hail ridership will result in less total ride-hail ridership than if using all path, person, and location type variables.


## Wait Times {#res-waits}
Figure \@ref(fig:waits) shows a detailed distribution of wait times for ride-hailing vehicles for the scenarios. As with ridership, we compare the scenarios with the *Asim* prefix against the scenarios without, and see only a slight difference in maximum wait times. Scenarios AsimBeamRideHail:PPL, AsimBeamAll:Path, and AsimBeamAll:PPL have almost identical mean wait times when compared to their counterparts in BeamRideHail:PPL, BeamAll:Path, BeamAll:PPL. We suppose that the existence of ride-hail in the initial plans will not affect *most* ride-hail wait times. 

```{r waits, echo = FALSE, warning = FALSE, message = FALSE, fig.cap = "Distribution of ride-hail wait times by mode choice combination scenario.", fig.align='center'}
tar_read(waits)
```

Alternately, comparing different BEAM mode options does significantly affect ride-hail wait times. The *None* type scenario (AsimRideHail) has the largest spread of wait times, the lowest mean wait time, and is "bottom heavy" -- referring to the fact that a major cluster of users wait less than 7.5 minutes. The *All* type scenarios have higher mean wait times (~9.3 minutes) than the *None* type and lower mean wait times than the *RideHail* type. Neither top nor bottom heavy, the *All* type scenarios seem to have a more even spread in wait times, ranging from 0.4 to 21 minutes. BEAM seems to paint ride-hail alternatives as more desirable than ActivitySim, as more users are willing to wait longer (12 to 18 minutes in the *All* scenarios). This is especially true with the *RideHail* type scenarios, as a large cluster of users are willing to wait 7.5 to 20 minutes. The *RideHail* type scenarios have the largest mean wait times (~10.65 minutes). Overall, wait time is significantly affected by which mode choice structure is used by BEAM, just like as was concluded with ridership.

The last group to compare collectively is between the Path and PPL models. By comparing BeamRideHail:Path and BeamRideHail:PPL, BeamAll:Path and BeamAll:PPL, and AsimBeamAll:Path and AsimBeamAll:PPL, we see that the Path models estimate a slightly higher maximum wait time. In addition, BeamRideHail:Path and AsimBeamRideHail:Path seem to have a larger cluster above a 10 minute wait time than BeamRideHail:PPL and AsimBeamRideHail:PPL. Besides these two observations though, the differences between utility parameters is minimal. Although ridership was affected by which utility parameters were used, wait time is only slightly affected.

Overall, by analyzing the ridership and wait times among different mode choice structures we learn that ride-hailing ridership and level of service is significantly affected by which mode choice structure is used in BEAM. We also propose that initial plans, and whether or not they include ride-hail, do not significantly affect the level at which BEAM estimates ridership or wait times. Lastly, we hypothesize that using all path, person, and location type variables will increase total ridership. We also suggest that the lack of person attributes in the utility equation may cause pooled and transit ride-hail options to look less appealing. Section \@ref(deep-look) takes a deeper look at why some of these patterns in the ridership and wait times results exist.

## Mode Choice Structures {#deep-look}
The results from Table \@ref(tab:tbexperiments) and the results from Figure \@ref(fig:waits) can be explained further by understanding the original setup of the experiments. The clearest distinction in ridership and wait times exist between BEAM mode choice structures. The *None*, *RideHail*, and *All* structure types each produce results at different magnitudes. These vastly different results are directly related to how each model structure is constructed.  

### None Mode Choice Model {#type1}
The *None* mode choice model produces the lowest ridership and shortest wait time values. With modal innovation turned off, agents were unable to choose new modes, and averted to walk modes if the current trip mode was deemed "impossible". This is verified by looking at Table \@ref(tab:noneloss). Iteration 0 (start) shows the number of ride-hailing modes input to BEAM. By the end of iteration 0, however, more than half the initial ride-hailing selections estimated by ActivitySim were lost. Then, by the end of the final iteration, only 300 ride-hailing trips remained. At the same time, total walk modes increased across each iteration. BEAM was unable to match agents with most of ActivitySim's ride-hailing predictions.

```{r, noneloss}
none <- matrix(c("0 (start)", 2412, 1837, 0, 4249,"0 (end)", 978, 615, 0, 1593, "12 (end)", 269, 21, 0, 300), ncol=5, byrow=TRUE)
colnames(none) <- c("Iteration", "Ride-hail", "Pooled Ride-hail", "Ride-hail Transit", "Total")
nonetab <- as.tibble(none)
kable(nonetab, caption = 'Loss of Ride-hailing Trips in the None Mode Choice Model.', booktabs = TRUE)  %>%
  kable_styling(latex_options="scale_down")
```

### All Mode Choice Model {#type3}
The *All* BEAM mode choice model uses the same mode choice utility function as ActivitySim and has all modal alternatives available. This adjusted model structure helps us understand why we obtained much higher ridership than with the *None* Model. Figure \@ref(fig:piechart) shows from which modes agents who switched to ride-hailing came from. Interestingly enough, the majority of agents who select ride-hail switched from car type modes (Car, HOV2, HOV3).

```{r piechart, echo = FALSE, warning = FALSE, message = FALSE, fig.cap = "Original mode choices of agents who switch to a ride-hail type mode.", fig.align='center'}
#tar_read(piechart)
#planshifts <- tar_read(planshifts)
#planshifts
#ggsave("planshifts.png", width = 12, height = 6)
#planshifts_facet <- tar_read(planshifts_facet)
#planshifts_facet
#ggsave("planshifts_facet.png", width = 12, height = 6)
# below is for wRH-All-All scenario
```

We offer some factors as to why so many car users switch to ride-hailing modes. The first is the array of utility parameters boosted the ride-hailing utility, making ride-hailing options attractive alternatives. Figure \@ref(fig:sankey) provides sufficient evidence for this claim. Figure \@ref(fig:sankey) shows a Sankey diagram of all modal decisions at the start of each iteration for those agents in the AsimBeamAll:PPL scenario who select the ride-hail mode by the end of the final iteration. The mode "No Mode" describes those modes that were cleared and reset at the beginning of each iteration. Notice how many of the Car, HOV2, HOV2 Passenger, HOV3, and HOV3 Passenger modes shift into the "No Mode" category each iteration. Also notice in the subsequent iteration how many of those "No Mode" choices shift to ride-hailing modes. A shift from the "No Mode" choice to ride-hail represents those agents choosing their mode based on the utility value. 

\begin{sidewaysfigure}

\centering
\includegraphics[width = 1.05\paperwidth]{planshifts.png}
\caption{The entire selection process by iteration of agents who use ride-hail on the final iteration (AsimBeamAll:PPL Scenario).}
\label{fig:sankey}

\end{sidewaysfigure}

Figure \@ref(fig:sankey2) further proves that many agents elect to use ride-hailing modes because the utility parameters represent them as attractive alternatives. Figure \@ref(fig:sankey2) displays the total number of ride-hailing trips at the end of each iteration as well as which modes were used on those same trips at the beginning of the iteration for the AsimBeamAll:PPL scenario. Notice how for the majority of iterations, a substantial share of agents move from the "No Mode" category to a ride-hailing choice instead. Interestingly though, before the beginning of the next iteration, most of those ride-hailing modes are lost, and new agents convert to a ride-hailing mode. This process continues, and explains why a substantial jump in ride-hailing trips occur between iteration 11 and iteration 12 in Figure \@ref(fig:sankey). In other words, only a small share of ride-hailing trips are retained across each iteration, and instead the mojority of ride-hailing trips are produced from individuals with their modes cleared or from the car and walk modes. 

\begin{sidewaysfigure}

\centering
\includegraphics[width = 1.05\paperwidth]{planshifts_facet.png}
\caption{The starting choice of agents who switch to ride-hail by each iteration's end (AsimBeamAll:PPL Scenario).}
\label{fig:sankey2}

\end{sidewaysfigure}


Another factor for why agents switch from car to ride-hailing is BEAM's complex car tracking algorithm, which keeps track of household and agent level vehicle allocation. For example, if a household owns one vehicle, then the vehicle is *assigned* to the first agent to use it in their daily plan. This leaves the other household members to choose an alternate mode. BEAM's implementation of vehicular assignment prevents many agents from selecting a car mode, whereas ActivitySim may not prevent those same individuals from car usage.

In addition to BEAM's vehicle assignment algorithm, BEAM's trip based mode choice structure forces some car users to switch modes. Sometimes, agents will *lose* their vehicle within the day when a pathway cannot be built. If an agent *loses* their car, car is no longer a valid modal alternative for future trips. Figure \@ref(fig:walkers) provides evidence for this statement. Figure \@ref(fig:walkers) displays a graph of those agents who start their day using a mode other than walk, but end up switching to the walk mode by the end of the day. Notice how in each hour, walk increases as car decreases or remains constant. Hundreds of car type mode users are switching to walk modes instead of remaining with their vehicle. Figure \@ref(fig:sankey) shows that many walk users shift to ride-hailing each iteration. Therefore, car users who shift to walk on one trip, may shift to ride-hailing on the next trip. This is true between corresponding iterations as well. Overall, the increase in ridership in the *All* model can be partially explained for these three reasons.

```{r walkers, echo = FALSE, warning = FALSE, message = FALSE, fig.cap = "Agents who switch to walk by time of day (AsimBeamAll:PPL Scenario).", fig.align='center'}
#graph of those agents who start their day not walking, and switch to walking before the end of the day
#for wRH-All-All Scenario
tar_read(walk_switchers)
```

### Ridehail Mode Choice Model {#type2}
Finally, the way the *RideHail* BEAM mode choice model was constructed explains why their ridership and wait times were high. The *RideHail* model only permitted walk and transit users the option to switch to ride-hailing modes; car-type modes remained locked across each iteration. Whenever a ride-hailing path could be built, all walk modes were automatically given the option to choose ride-hail or ride-hail pooled and all transit modes were automatically given the option to choose ride-hail transit. Although it made logical sense to lock all car-type modes (for reasons described in Section \@ref(type3)), by giving ride-hail options only to walk and transit users, ridership increased even more than in the *All* scenario. The increase in ridership occurred because 1.) BEAM's adjusted code forced ride-hail to be an option in almost all cases, and 2.) in most cases ride-hail was calculated to be more attractive than walk or transit modes.

Table \@ref(tab:timeutil) provides evidence in ride-hail being an attractive mode choice alternative. Table \@ref(tab:timeutil) displays the ride-hail time utilization for each of the scenarios performed. The same ride-hail fleet was used in each of the nine scenario, composed of 952 ride-hailing driver shifts. Ride-hail time utilization was calculated as the sum of all the driver shift times divided by the sum of all passenger occupied ride-hailing travel time. The AsimRideHail scenario had the lowest ride-hail time utilization, at only 4.0%. Interestingly, the *All* type scenarios ranged from 53.1% to 62.5% ride-hail time utilization. This explains the higher wait times shown in Figure \@ref(fig:waits). Finally, by analyzing the ride-hail time utilization for the *RideHail* scenarios, we fully understand how attractive ride-hail was. With 70.3% to 73.8% of ride-hail time utilization present for the *RideHail* scenarios, we see three fourths of each driver's shift was used to transport passengers. This explains the attractiveness of the choice, the extreme increase in ridership, and  also the increased wait time for the *RideHail* type scenarios.  

```{r timeutil, echo=FALSE}
time_utilization <- tar_read(ridehail_utilization) %>% select(2,6) %>% rename("Ride-hail Time Utilization" = RideHailTimeUtilization, "Scenario Name" = ScenarioName)
kable(time_utilization, caption = 'Percent Ride-hail Time Utilization by Mode Choice Combination Scenario', booktabs = TRUE)
  #kable_styling(latex_options="scale_down")
```

```{r personutil, echo=FALSE}
#person_utilization <- tar_read(rh_utilization) %>% select(1,6)
#kable(person_utilization, caption = 'Ride-hail (person / hour) utilization by mode choice combination scenario.', booktabs = TRUE)  %>%
#  kable_styling(latex_options="scale_down")
```

### Summary
As seen by the explanation of the structure of the *None*, *All*, and *RideHail* type scenarios, how BEAM's different mode choice structures were programmed affected ride-hailing ridership and wait time. Fortunately, Section \@ref(discussion) further describes the deeper meaning behind the ride-hail, wait time, and mode choice structure results discovered in this section.
